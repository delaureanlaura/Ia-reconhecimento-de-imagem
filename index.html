<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector AutomÃ¡tico âš¡</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #111; color: white; padding: 10px; }
        
        #camera-box { 
            width: 320px; height: 240px; 
            margin: 10px auto; 
            border: 4px solid #444;
            border-radius: 10px;
            overflow: hidden;
            background: black;
        }

        video { 
            width: 100%; height: 100%; object-fit: cover; 
            transform: scaleX(-1); /* Espelhado */
        }

        /* Caixa de Status Gigante */
        #status-box { 
            font-size: 26px; font-weight: bold; margin: 15px; padding: 20px; 
            border-radius: 12px; background: #333; transition: all 0.1s;
        }

        #debug-info { font-size: 14px; color: #888; margin-top: 10px; font-family: monospace; }

        .btn { 
            padding: 15px 30px; font-size: 18px; font-weight: bold;
            background: #007bff; color: white; border: none; border-radius: 8px; 
            cursor: pointer; margin-top: 10px; width: 100%; max-width: 320px;
        }
    </style>
</head>
<body>

    <h2>Detector RÃ¡pido âš¡</h2>

    <div id="camera-box">
        <video id="video" autoplay playsinline muted></video>
    </div>

    <div id="status-box">Aguardando...</div>
    
    <div id="debug-info">Certeza: 0%</div>

    <button id="btn" class="btn" onclick="iniciar()">LIGAR CÃ‚MERA</button>

    <audio id="sirene" src="https://www.soundjay.com/mechanical/sounds/smoke-detector-1.mp3" loop></audio>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script>
        // SEU LINK DO TEACHABLE MACHINE
        const URL_MODELO = "https://teachablemachine.withgoogle.com/models/jWz2PDp6t/";
        
        let model, maxPredictions;
        const somSirene = document.getElementById('sirene');
        const statusBox = document.getElementById('status-box');
        const debugBox = document.getElementById('debug-info');

        async function iniciar() {
            const btn = document.getElementById('btn');
            btn.disabled = true;
            btn.innerText = "CARREGANDO...";

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                document.getElementById('video').srcObject = stream;

                model = await tmImage.load(URL_MODELO + "model.json", URL_MODELO + "metadata.json");
                maxPredictions = model.getTotalClasses();

                btn.style.display = 'none';
                loop();
            } catch (e) {
                alert("Erro: " + e.message);
                btn.disabled = false;
                btn.innerText = "TENTAR NOVAMENTE";
            }
        }

        async function loop() {
            if (model) {
                const video = document.getElementById('video');
                const prediction = await model.predict(video);
                
                // PEGA AS DUAS CLASSES PELO ÃNDICE (0 = Class 1, 1 = Class 2)
                // Class 1 = Com Celular
                // Class 2 = Sem Celular
                const probComCelular = prediction[0].probability; 
                const probSemCelular = prediction[1].probability;

                // ATUALIZA OS NÃšMEROS NA TELA
                debugBox.innerText = `Class 1 (Com): ${(probComCelular*100).toFixed(0)}% | Class 2 (Sem): ${(probSemCelular*100).toFixed(0)}%`;

                // LÃ“GICA DE TROCA AUTOMÃTICA
                // Se a probabilidade da Class 1 for maior que 60% (0.60)
                if (probComCelular > 0.60) {
                    modoPerigo();
                } else {
                    modoSeguro();
                }
            }
            // Roda o loop o mais rÃ¡pido possÃ­vel
            requestAnimationFrame(loop);
        }

        function modoPerigo() {
            statusBox.innerText = "ðŸš¨ COM CELULAR!";
            statusBox.style.backgroundColor = "#ff0000"; // Vermelho
            statusBox.style.color = "white";
            
            if (somSirene.paused) somSirene.play();
        }

        function modoSeguro() {
            statusBox.innerText = "âœ… SEM CELULAR";
            statusBox.style.backgroundColor = "#00cc00"; // Verde
            statusBox.style.color = "black";
            
            somSirene.pause();
            somSirene.currentTime = 0;
        }
    </script>
</body>
</html>