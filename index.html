<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector CodeMinds ðŸš¨</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #222; color: white; padding: 20px; }
        
        #camera-box { 
            width: 320px; height: 240px; 
            margin: 20px auto; 
            border: 5px solid #555;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            background: black;
        }

        /* Espelhamento para ficar igual ao treinamento */
        video { 
            width: 100%; height: 100%; object-fit: cover; 
            transform: scaleX(-1); 
        }

        #resultado { 
            font-size: 28px; font-weight: bold; margin: 20px; padding: 15px; 
            border-radius: 8px; background: #333; transition: background 0.2s;
        }

        .btn { 
            padding: 15px 40px; font-size: 20px; font-weight: bold;
            background: #007bff; color: white; border: none; border-radius: 50px; 
            cursor: pointer; margin-top: 10px;
        }
        .btn:disabled { background: #555; cursor: wait; }
    </style>
</head>
<body>

    <h1>Detector CodeMinds ðŸ“µ</h1>
    <p>Monitoramento ativo (VersÃ£o Movimento)</p>

    <div id="camera-box">
        <video id="video" autoplay playsinline muted></video>
    </div>

    <div id="resultado">Aguardando...</div>
    <button id="btn" class="btn" onclick="iniciar()">LIGAR SISTEMA</button>

    <audio id="sirene" src="https://www.soundjay.com/mechanical/sounds/smoke-detector-1.mp3" loop></audio>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script>
        // SEU LINK NOVO AQUI:
        const URL_MODELO = "https://teachablemachine.withgoogle.com/models/jWz2PDp6t/";
        
        let model, maxPredictions;
        const somSirene = document.getElementById('sirene');

        async function iniciar() {
            const btn = document.getElementById('btn');
            btn.disabled = true;
            btn.innerText = "CARREGANDO...";

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                document.getElementById('video').srcObject = stream;

                model = await tmImage.load(URL_MODELO + "model.json", URL_MODELO + "metadata.json");
                maxPredictions = model.getTotalClasses();

                btn.style.display = 'none';
                loop();
            } catch (e) {
                alert("Erro: " + e.message);
                btn.disabled = false;
                btn.innerText = "TENTAR NOVAMENTE";
            }
        }

        async function loop() {
            if (model) {
                const video = document.getElementById('video');
                const prediction = await model.predict(video);
                
                let detectou = false;

                for (let i = 0; i < maxPredictions; i++) {
                    // TRUQUE: Converte para minÃºsculo e procura a palavra "celular"
                    // Assim funciona para "Com celular", "com celular" ou "Class 1 celular"
                    const nomeClasse = prediction[i].className.toLowerCase();
                    
                    if (nomeClasse.includes("celular") && prediction[i].probability > 0.70) {
                        detectou = true;
                    }
                }

                atualizarTela(detectou);
            }
            requestAnimationFrame(loop);
        }

        function atualizarTela(detectou) {
            const res = document.getElementById('resultado');
            
            if (detectou) {
                document.body.style.backgroundColor = "#ff0000";
                res.innerText = "ðŸš¨ CELULAR DETECTADO! ðŸš¨";
                res.style.backgroundColor = "white";
                res.style.color = "red";
                
                if (somSirene.paused) somSirene.play();
                
            } else {
                document.body.style.backgroundColor = "#222";
                res.innerText = "âœ… Limpo";
                res.style.backgroundColor = "#333";
                res.style.color = "#0f0";
                
                somSirene.pause();
                somSirene.currentTime = 0;
            }
        }
    </script>
</body>
</html>