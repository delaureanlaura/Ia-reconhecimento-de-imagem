<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector VERSUS ü•ä</title>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; background: #111; color: white; margin: 0; padding: 10px; }
        
        #camera-box { 
            width: 100%; max-width: 320px; height: 240px; 
            margin: 0 auto; 
            border: 4px solid #444; border-radius: 10px;
            overflow: hidden; background: black;
        }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }

        /* √ÅREA DA BATALHA */
        .versus-container {
            display: flex;
            justify-content: space-between;
            margin: 20px auto;
            max-width: 400px;
            height: 40px;
            background: #333;
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid #555;
        }

        .barra {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            transition: width 0.1s linear;
            white-space: nowrap;
        }

        /* Classe 1 (Celular) - Vermelho */
        #barra-celular { background: #ff3333; width: 50%; }
        
        /* Classe 2 (Sem) - Verde */
        #barra-sem { background: #00cc66; width: 50%; color: black; }

        #vencedor { font-size: 28px; font-weight: bold; margin: 20px; padding: 10px; border-radius: 8px; }

        .btn { 
            padding: 15px; font-size: 18px; font-weight: bold; 
            background: #007bff; color: white; border: none; border-radius: 8px; 
            width: 100%; max-width: 300px; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="camera-box">
        <video id="video" autoplay playsinline muted></video>
    </div>

    <div id="vencedor">Carregando...</div>

    <div class="versus-container">
        <div id="barra-celular">COM: 0%</div>
        <div id="barra-sem">SEM: 0%</div>
    </div>

    <button id="btn" class="btn" onclick="iniciar()">INICIAR BATALHA</button>
    <audio id="sirene" src="https://www.soundjay.com/mechanical/sounds/smoke-detector-1.mp3" loop></audio>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script>
        const URL_MODELO = "https://teachablemachine.withgoogle.com/models/jWz2PDp6t/";
        
        let model, maxPredictions;
        const somSirene = document.getElementById('sirene');
        const txtVencedor = document.getElementById('vencedor');

        // Elementos das Barras
        const barraCelular = document.getElementById('barra-celular');
        const barraSem = document.getElementById('barra-sem');

        async function iniciar() {
            const btn = document.getElementById('btn');
            btn.disabled = true; btn.innerText = "LIGANDO...";
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                document.getElementById('video').srcObject = stream;
                model = await tmImage.load(URL_MODELO + "model.json", URL_MODELO + "metadata.json");
                maxPredictions = model.getTotalClasses();
                btn.style.display = 'none';
                loop();
            } catch (e) { alert("Erro: " + e.message); location.reload(); }
        }

        async function loop() {
            if (model) {
                const prediction = await model.predict(document.getElementById('video'));
                
                // PEGA OS VALORES REAIS (0 a 1)
                // Assumindo que:
                // Class 0 = Com Celular
                // Class 1 = Sem Celular (Seu "2 sem")
                let probCom = prediction[0].probability;
                let probSem = prediction[1].probability;

                // Converte para Porcentagem (0 a 100)
                let pctCom = (probCom * 100).toFixed(0);
                let pctSem = (probSem * 100).toFixed(0);

                // ATUALIZA AS BARRAS NA TELA
                barraCelular.style.width = pctCom + "%";
                barraCelular.innerText = "CELULAR: " + pctCom + "%";

                barraSem.style.width = pctSem + "%";
                barraSem.innerText = "LIMPO: " + pctSem + "%";

                // QUEM GANHA? (L√≥gica Simples: Quem for maior vence)
                if (probCom > probSem) {
                    modoPerigo(); // Vermelho ganha
                } else {
                    modoSeguro(); // Verde ganha
                }
            }
            requestAnimationFrame(loop);
        }

        function modoPerigo() {
            if (txtVencedor.innerText !== "üö® CELULAR DETECTADO") {
                txtVencedor.innerText = "üö® CELULAR DETECTADO";
                txtVencedor.style.backgroundColor = "red";
                document.body.style.backgroundColor = "#500";
                if (somSirene.paused) somSirene.play();
            }
        }

        function modoSeguro() {
            if (txtVencedor.innerText !== "‚úÖ √ÅREA LIMPA") {
                txtVencedor.innerText = "‚úÖ √ÅREA LIMPA";
                txtVencedor.style.backgroundColor = "green";
                document.body.style.backgroundColor = "#111";
                somSirene.pause();
                somSirene.currentTime = 0;
            }
        }
    </script>
</body>
</html>